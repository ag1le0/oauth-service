<!DOCTYPE html>
<html lang="en" class="js-focus-visible" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org" layout:decorate="~{fragments/layout}">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Smart Factory">
    <meta name="author" content="FII - Icarus">
    <title>Smart Factory</title>
    <meta name="keywords"
          content="Clear login Form a Responsive Web Template, Bootstrap Web Templates, Flat Web Templates, Android Compatible Web Template, Smartphone Compatible Web Template, Free Webdesigns for Nokia, Samsung, LG, Sony Ericsson, Motorola Web Design">
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/icons/fontawesome/styles.min.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/bootstrap.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/core.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/components.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/colors.css}">
    <link rel="stylesheet" type="text/css" th:href="@{assets/css/icons/icomoon/styles.css}">

    <link id="codefund-style" rel="stylesheet" media="all" th:href="@{/assets/css/custom/code_fund_ad-781ed628.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/assets/js/plugins/paginationTable/simplePagination.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/plugins/datatables/datatables.min.css}">
    <link th:href="@{/assets/css/custom/style-user-manager.css}" rel="stylesheet" type="text/css">

    <!--//fonts-->
    <link rel="icon" type="image/ico" th:href="@{/assets/images/logoFavicon.png}">
    <script type="text/javascript" th:src="@{/assets/js/core/libraries/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/assets/js/core/libraries/bootstrap.min.js}"></script>
    <script type="text/javascript" th:src="@{/assets/js/plugins/paginationTable/jquery.simplePagination.js}"></script>
    <script type="text/javascript" th:src="@{/assets/js/plugins/tables/datatables/datatables.min.js}"></script>
</head>
<style>
    .dataTables_filter{
        display: none;
    }
     /* .icon-filter:after {
        content: "\e98e";
        font-family: 'icomoon';
        font-size: 12px;
        display: inline-block;
        position: absolute;
        top: 50%;
        right: 0;
        margin-top: -6px;
        color: #999999;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    } */
    table.dataTable thead th, table.dataTable thead td{
        border-bottom: none;
    }
    /* table.dataTable.no-footer {
        border-bottom: none;
        margin-bottom: 5px;
        box-shadow: 2px 2px #fff;
        border-radius: 5px;
    } */
    .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        color: #f7f7f7 !important;
        border: 1px solid #ffffff;
        background-color: white;
        border-radius: 3px;
        background: #003c9d;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button {
        margin-left: 0;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button:active{
        background: #003c9d;
        box-shadow: inset 0 0 3px #003c9d;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        border: 1px solid #003c9d;
        background: #003c9d;
        border-radius: 3px;
    }
    .dataTables_paginate{
        margin: 5px 0 15px 15px;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button{
        box-sizing: border-box;
        display: inline-block;
        min-width: 1.5em;
        padding: 0.3em 1em;
        text-align: center;
        text-decoration: none !important;
        cursor: pointer;
        color: #333 !important;
        border: 1px solid transparent;
        border-radius: 2px;
    }
    .pagination a {
        color: black;
        float: left;
        padding: 8px 16px;
        text-decoration: none;
        transition: background-color .3s;
    }

    .pagination a.current {
        background-color: dodgerblue;
        color: white;
    }
</style>
<body>
    <div class="row" style="margin: unset;">
        <div class="col-lg-12" style="padding: 0;">
            <div class="table-title-user col-md-12 col-sm-12">
                <div class="row" style="margin: 0;">
                    <h1 style="float: left;">
                        <spring:message th:text="#{managementUser.title}" />
                        <!-- Management Users -->
                    </h1>
                    <div class="class-element-right" style="float: right;">
                        <button class="btn btn-xs" id="btn-add-user" data-toggle="modal"
                        data-target="#modal-user-add" onclick="addUser()">
                            <i class="fa fa-plus"></i>
                        </button>
                        <div class="icon-filter" style="margin-left: 10px;float: left;">
                            <input type="search" id="txtFilterUser" placeholder="Search by Username">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="row" style="margin-top: 10px;background: #e0e0e0;padding-top: 10px;border-radius: 3px;">
                <div class="col-md-12">
                    <table class="table table-striped table-sticky" id="tblUserList">
                        <thead>
                            <tr>
                                <th>
                                    <spring:message th:text="#{managementUser.stt}" />
                                    <!-- STT -->
                                </th>
                                <th>
                                    <spring:message th:text="#{managementUser.username}" />
                                    <!-- User Name -->
                                </th>
                                <th>
                                    <spring:message th:text="#{signUp.name}" />
                                    <!-- Name -->
                                </th>
                                <th>
                                    <spring:message th:text="#{profile.chineseName}" />
                                    <!-- Chinese Name -->
                                </th>
                                <th>
                                    <spring:message th:text="#{profile.depart}" />
                                    <!-- Department -->
                                </th>
                                <th>
                                    <spring:message th:text="#{profile.email}" />
                                    <!-- Email -->
                                </th>
                                <th>
                                    <spring:message th:text="#{managementUser.roles}" />
                                    <!-- Roles -->
                                </th>
                                <th>
                                    <spring:message th:text="#{managementUser.locked}" />
                                    <!-- Locked -->
                                </th>
                                <th>
                                    <spring:message th:text="#{managementUser.active}" />
                                    <!-- Active -->
                                </th>
                                <th>
                                    <spring:message th:text="#{managementUser.action}" />
                                    <!-- Action -->
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div class="col-sm-6 pt-5 pb-5"></div>
                <div class="col-sm-6 pt-5 pb-5" style="text-align: right;">
                    <div id="pagination" class="pagination"></div>
                </div>
            </div>
        </div>
    </div>
     <!-- Modal Edit -->
    <div id="modal-user-edit" class="modal fade" role="dialog">
        <div class="modal-dialog" style="font-size: 13px;">
            <div class="modal-content">
                <form id="edit-form" th:action="@{/mng/user/add-role}" method="post">
                    <div class="modal-header"
                        style="background: #0b3e78;color: #fff;padding: 5px 5px;border-bottom-color: #ddd;">
                        <div class="col-md-12" style="padding-left: 5px;">
                            <button class="btn" id="id-add-usered" onclick="addNewRole()">
                                <i class="fa fa-plus"></i>
                            </button>
                            <h6 class="modal-title text-bold"
                                style="float: left;margin-top: 5px; margin-bottom: 5px;font-weight: bold;">
                                <spring:message th:text="#{managementUser.modalTitleEdit}" />
                                <!-- New/ Edit -->
                            </h6>
                            <button type="button" class="close" data-dismiss="modal"
                                style="position: absolute;right: 10px;top: 2px;color: #fff;"><i
                                    class="fa fa-times"></i></button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="row">
                                <div class="col-md-12">
                                    <table class="table table-bordered" id="tbl-role-edit"
                                        style="background-color: #fff; font-weight: 400;">
                                        <thead style="background: #0b3e78;color: #fff;">
                                            <tr class="thead">
                                                <th style="width: 10%;">
                                                    <spring:message th:text="#{managementUser.stt}" />
                                                    <!-- STT -->
                                                </th>
                                                <th style="width: 65%;">
                                                    <spring:message th:text="#{managementUser.role}" />
                                                    <!-- Role -->
                                                </th>
                                                <th>
                                                    <spring:message th:text="#{managementUser.action}" />
                                                    <!-- Action -->
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbodyRole">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Add-new -->
    <div id="modal-user-add" class="modal fade" role="dialog">
        <div class="modal-dialog" style="font-size: 13px;">
            <div class="modal-content">
                <form id="add-form" th:action="@{/mng/user/add-role}" method="post">
                    <div class="modal-header"
                        style="background: #0b3e78;color: #fff;padding: 5px 15px;border-bottom-color: #ddd;">
                        <button type="button" class="close" data-dismiss="modal"
                            style="position: absolute;right: 10px;top: 5px;"><i class="icon-cross" style="color: #fff;"></i>
                        </button>
                        <h6 class="modal-title text-bold"
                            style="margin-top: 5px; margin-bottom: 5px;font-weight: bold;">
                            <spring:message th:text="#{managementUser.modalAddUser}" />
                            <!-- Add user -->
                        </h6>
                    </div>
                    <div class="modal-body">
                        <div class="row" style="margin: unset;">
                            <div class="form-group row">
                                <label class="col-md-3 control-label text-bold" style="padding-top: 8px;">
                                    <spring:message th:text="#{managementUser.username}" />
                                    <!-- User name -->
                                </label>
                                <div class="col-md-9">
                                    <input type="text" required name="userName" class="form-control">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 control-label text-bold" style="padding-top: 8px;">
                                    <spring:message th:text="#{signUp.name}" />
                                    <!-- Name -->
                                </label>
                                <div class="col-md-9">
                                    <input type="text" name="name" class="form-control">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 control-label text-bold" style="padding-top: 8px;">
                                    <spring:message th:text="#{profile.chineseName}" />
                                </label>
                                <div class="col-md-9">
                                    <input type="text" name="chineseName" class="form-control">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 control-label text-bold" style="padding-top: 8px;">
                                    <spring:message th:text="#{signUp.email}" />
                                    <!-- Email -->
                                </label>
                                <div class="col-md-9">
                                    <input type="text" name="email" class="form-control">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 control-label text-bold" style="padding-top: 8px;">
                                    <spring:message th:text="#{managementUser.roles}" />
                                    <!-- Roles -->
                                </label>
                                <div class="col-md-9">
                                    <div class="select-roles">
                                        <select class="form-control" id="idRoleAdd" name="roleAdd" data-none-selected-text="Select roles">
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer form-group">
                        <a class="btn btn-default" data-dismiss="modal" style="background: #0b3e78;color: #fff;padding: 4px 8px;text-transform: inherit;">
                            <i class="icon-cross position-left" style="color: #fff;"></i>
                            <spring:message th:text="#{managementUser.modalClose}" />
                            <!-- Close -->
                        </a>
                        <a class="btn btn-sm" data-dismiss="modal" style="background: #105eb5;color: #fff;padding: 4px 8px;margin-right: 10px;text-transform: inherit;"
                            onclick="postUserAdd()">
                            <spring:message th:text="#{managementUser.modalSubmitAdd}" />
                            <!-- Submit -->
                            <i class="icon-arrow-right14 position-right"></i>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Modal Delete -->
    <div id="modal-user-delete" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"
                    style="padding: 5px 15px;background: #0b3e78;color: #fff;border-bottom-color: #ddd;">
                    <button type="button" class="close" data-dismiss="modal"
                        style="position: absolute;right: 10px;top: 5px;"><i class="icon-cross"></i>
                    </button>
                    <h6 class="modal-title text-bold" style="margin-top: 5px; margin-bottom: 5px;">
                        <spring:message th:text="#{managementUser.modalDelete}" />
                        <!-- DELETE -->
                    </h6>
                </div>
                <form id="remove-user-form" th:action="@{/mng/user/remove-role}" method="post">
                    <div class="modal-body">
                        <div class="row">
                            <div class="form-group">
                                <input type="hidden" name="idDelete" value="" />
                                <input type="hidden" name="roleDelete" value="" />
                                <label class="col-xs-12 control-label" style="padding-top: 8px;">
                                    <spring:message th:text="#{managementUser.modalDeleteContent1}" />
                                    <!-- Do you want to  -->
                                    <span id="idAddRole"> </span> 
                                    <spring:message th:text="#{managementUser.modalDeleteContent2}" />
                                    <!-- delete ? -->
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer form-group">
                        <a class="btn btn-default" data-dismiss="modal" style="background: #0b3e78;color: #fff; text-transform: inherit;"  onclick="closeDelete()">
                            <i class="icon-cross position-left"></i>
                            <spring:message th:text="#{managementUser.modalClose}" />
                            <!-- Close -->
                        </a>
                        <a class="btn btn-sm" data-dismiss="modal" style="background: #105eb5;color: #fff;text-transform: inherit;"
                            onclick="applydelete();">
                            <spring:message th:text="#{managementUser.modalDelete}" />
                            <!-- Submit -->
                            <i class="icon-arrow-right14 position-right"></i>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Modal Refresh -->
    <div id="modal-user-refresh" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="refresh-form" th:action="@{/mng/user/refresh-password}" method="post">
                    <div class="modal-header"
                        style="padding: 5px 15px;background: #0b3e78;color: #fff;border-bottom-color: #ddd;">
                        <button type="button" class="close" data-dismiss="modal"
                            style="position: absolute;right: 10px;top: 5px;"><i class="icon-cross" style="color: #fff;"></i></button>
                        <h6 class="modal-title text-bold" style="margin-top: 5px; margin-bottom: 5px;">
                            <spring:message th:text="#{managementUser.refreshPass}" />
                            <!-- Refresh password -->
                        </h6>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="form-group">
                                <input type="hidden" name="idPass" value="" />
                                <label class="col-xs-12 control-label">
                                    <spring:message th:text="#{managementUser.refreshPassContent}" />
                                    <!-- Do you want to refresh password ? -->
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer form-group">
                        <a class="btn btn-default btn-closeDelete" data-dismiss="modal" style="background: #0b3e78;color: #fff;text-transform: inherit;">
                            <i class="icon-cross position-left"></i>
                            <spring:message th:text="#{managementUser.modalClose}" />
                            <!-- Close -->
                        </a>
                        <a class="btn btn-sm btn-submitDelete" data-dismiss="modal" style="background: #105eb5;color: #fff;text-transform: inherit;"
                            onclick="applyRefreshPassword();">
                            <spring:message th:text="#{managementUser.modalSubmit}" />
                            <!-- Submit -->
                            <i class="icon-arrow-right14 position-right"></i>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
<script>
    var dataset = {
        page: 0
    };
    var gloData, getValueRole, getId, valueRole;
    var datarole, table;

    loadData();
    function loadData() {
        $.ajax({
            type: "GET",
            url: "/oauth-service/mng/user",
            data: {
                page: dataset.page,
                size: 15,
                username: dataset.username
            },
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                var resultData = result.data;
                $('#tblUserList>tbody').html('');
                $('#pagination').html('');
                if (resultData !=[] && resultData != null && resultData !='') {
                    var html = '';
                    var stt = 0, sttRoles = 0;
                    for (i in resultData) {
                        var tbodyRoles = '';
                        stt++;
                        var valueRoles = resultData[i].roles;
                        var dataRoles = [];
                        var getId;
                        var valueChineseName = resultData[i].chineseName == null ? '' : resultData[i].chineseName;
                        var valueUserName = resultData[i].username == null ? '' : resultData[i].username;
                        var valueName = resultData[i].name == null ? '' : resultData[i].name;
                        var department = resultData[i].department == null ? '' : resultData[i].department;
                        var valueEmail = resultData[i].email == null ? '' : resultData[i].email;
                        for (j in valueRoles) {
                            sttRoles++;
                            var valueR = '';
                            getId += valueRoles[j].id;
                            valueR += valueRoles[j].role;
                            dataRoles.push(valueR);
                        }
                        var convertArray = dataRoles.toString();
                        var checkArray = convertArray.split(',').join(', ');
                        html += '<tr>'
                            +'<td class="class-page">'+stt+'</td>'
                            +'<td>' + valueUserName + '</td>'
                            +'<td>' + valueName + '</td>'
                            +'<td>' + valueChineseName + '</td>'
                            +'<td>' + department + '</td>'
                            +'<td>' + valueEmail + '</td>'
                            + '<td class="classRoles">' + checkArray + '</td>'
                            +'<td class="classlocked">' + resultData[i].locked + '</td>'
                            +'<td class="classActive">' + resultData[i].active + '</td>'
                            + '<td>'
                                + '<a class="btn btnReset" data-toggle="modal" data-id="' + resultData[i].id + '" data-user="' + resultData[i].username + '" data-name="' + resultData[i].name + '" data-chinese="' + resultData[i].chineseName + '" data-email="' + resultData[i].email + '" data-role="' + convertArray + '" data-target="#modal-user-refresh" onclick="refreshUser(this)" title="Click to refresh password">'
                                    +'<i class="fa fa-refresh"></i>'
                                +'</a>'
                                + '<a class="btn btnEdit" onclick="loadModal(this)" data-id="' + resultData[i].id + '" data-role="' + dataRoles + '" data-toggle="modal" data-target="#modal-user-edit" onclick="editUser(this)">'
                                    +'<i class="fa fa-edit"></i>'
                                +'</a>'
                            + '</td>'
                            + '</tr>';
                    }
                    $('#tblUserList>tbody').html(html);
                    var size = 0;
                    if(result.size % 15 > 0) {
                        size = parseInt(result.size / 15) + 1;
                    } else {
                        size = parseInt(result.size / 15);
                    }
                    pagination(size, dataset.page);
                } else {
                    $('#tblUserList>tbody').html('<tr><td colspan="11" style="text-align:center">--No data--</td></tr>');
                }
            },
            failure: function (errMsg) {
                console.log(errMsg);
            }
        });
    }
    $('#txtFilterUser').on('keyup',function(e){
        if(e.keyCode == 13) {
            dataset.username = $(this).val();
            loadData();
        }
    });

    function loadDataUser() {
        $.ajax({
            type: "GET",
            url: "/oauth-service/mng/user",
            data: {
                // page: 0,
                // size: 15
            },
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                dataset.totalPage = result.size;
                if (dataset.totalPage > 0) {
                    pgDataUser(0);
                } else {
                    $('#tblUserList>tbody').html('<tr><td colspan="11" text-align="center">--No data--</td></tr>');
                }
            },
            failure: function (errMsg) {
                console.log(errMsg);
            }
        });
    }
    function pgDataUser(index) {
        $.ajax({
            type: "GET",
            url: "/oauth-service/mng/user",
            data: {
                page: index,
                size: dataset.totalPage
            },
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                var resultData = result.data;
                if (resultData !=[] && resultData != null && resultData !='') {
                    if(table){
                        table.clear();
                        table.destroy();
                    };
                    var html = '';
                    // var option = '<option data-value= "true" value="true" data-role="true">true</option><option data-value= "false" value="false" data-role="false">false</option>';
                    var stt = 0, sttRoles = 0;
                    // var indexstt=index*14;
                    for (i in resultData) {
                        var tbodyRoles = '';
                        stt++;
                        var valueRoles = resultData[i].roles;
                        var dataRoles = [];
                        var getId;
                        var valueChineseName = resultData[i].chineseName == null ? '' : resultData[i].chineseName;
                        var valueUserName = resultData[i].username == null ? '' : resultData[i].username;
                        var valueName = resultData[i].name == null ? '' : resultData[i].name;
                        var department = resultData[i].department == null ? '' : resultData[i].department;
                        var valueEmail = resultData[i].email == null ? '' : resultData[i].email;
                        for (j in valueRoles) {
                            sttRoles++;
                            var valueR = '';
                            getId += valueRoles[j].id;
                            valueR += valueRoles[j].role;
                            dataRoles.push(valueR);
                        }
                        // indexstt++;
                        var convertArray = dataRoles.toString();
                        var checkArray = convertArray.split(',').join(', ');
                        // console.log('checkArray',checkArray);
                        html += '<tr>'
                            +'<td class="class-page">'+stt+'</td>'
                            +'<td>' + valueUserName + '</td>'
                            +'<td>' + valueName + '</td>'
                            +'<td>' + valueChineseName + '</td>'
                            +'<td>' + department + '</td>'
                            +'<td>' + valueEmail + '</td>'
                            + '<td class="classRoles">' + checkArray + '</td>'
                            +'<td class="classlocked">' + resultData[i].locked + '</td>'
                            +'<td class="classActive">' + resultData[i].active + '</td>'
                            + '<td>'
                                + '<a class="btn btnReset" data-toggle="modal" data-id="' + resultData[i].id + '" data-user="' + resultData[i].username + '" data-name="' + resultData[i].name + '" data-chinese="' + resultData[i].chineseName + '" data-email="' + resultData[i].email + '" data-role="' + convertArray + '" data-target="#modal-user-refresh" onclick="refreshUser(this)" title="Click to refresh password">'
                                    +'<i class="fa fa-refresh"></i>'
                                +'</a>'
                                + '<a class="btn btnEdit" onclick="loadModal(this)" data-id="' + resultData[i].id + '" data-role="' + dataRoles + '" data-toggle="modal" data-target="#modal-user-edit" onclick="editUser(this)">'
                                    +'<i class="fa fa-edit"></i>'
                                +'</a>'
                            // + '<button class="btn btnDelete" data-id="' + resultData[i].id + '" data-user="' + resultData[i].username + '" data-name="' + resultData[i].name + '" data-chinese="' + resultData[i].chineseName + '" data-email="' + resultData[i].email + '" data-role="' + convertArray + '" data-toggle="modal" data-target="#modal-user-delete" onclick="deleteUser(this)"><i class="fa fa-trash"></i></button>'
                            + '</td>'
                            + '</tr>';
                    }
                    $('#tblUserList>tbody').html(html);
                    $('#tblUserList_paginate').removeClass("hidden");
                    $('#tblUserList_info').removeClass("hidden");
                    table = $('#tblUserList').DataTable({
                        "paging": true,
                        "pageLength":15,
                        "lengthChange": false,
                        "searching": true,
                        "ordering": false,
                        "info": false,
                        "language": {
                            "paginate":{
                                "previous": "<<",
                                "next": ">>"
                            }
                        },
                        bAutoWidth: false,
                        aoColumns: [
                            {sWidth:'3%'},{sWidth:'9%'},
                            {sWidth:'10%'},{sWidth:'8%'},
                            {sWidth:'8%'},{sWidth:'6%'},
                            {sWidth:'8%'},{sWidth:'9%'},
                            {sWidth:'7%'},{sWidth:'7%'}
                        ]
                    });
                    $('#txtFilterUser').on('keyup',function(){
                        table.search(this.value).draw();
                    });
                } else {
                    alert("Please login!!!");
                    $('#tblUserList>tbody').html('<tr><td colspan="11" text-align="center">--No data--</td></tr>');
                    if(table){
                        table.clear();
                        $('#tblUserList_paginate').addClass("hidden");
                        $('#tblUserList_info').addClass("hidden");
                    }
                }
            },
            failure: function (errMsg) {
                console.log(errMsg);
            }
        });
    }
    // function functionSelectLocked(stt){
        // var valueEployee = $('#idLocked'+stt).find(':selected').attr('data-value');
        // $('#idEmployeeTable'+stt).val(valueEployee);
    // }
    $('#modal-user-add').on('hidden.bs.modal', function (){
    });
    $('#modal-user-delete').on('hidden.bs.modal', function (){
    });
    $('#modal-user-refresh').on('hidden.bs.modal', function (){
    });
    function loadModal(context) {
        getId = context.dataset.id;
        valueRole = context.dataset.role;
        var arrayRole = valueRole.split(",");
        var tbodyRoles = '';
        var sttRoles = 0;
        for (i in arrayRole) {
            sttRoles++;
            getRole = arrayRole[i];
            tbodyRoles += '<tr>'
                + '<td>' + sttRoles + '</td>'
                + '<td class="class-role">'
                + '<input id="txtEditRole' + i + '" class="form-control classInputRole hidden" type="text" required="" value="' + getRole + '" />'
                + '<span class="classSpanRole" id="spanRole' + i + '">' + getRole + '</span>'
                + '</td>'
                + '<td class="class-button">'
                + '<a type="button" class="btn delete btnDeleteTableRole" id="deleteRow' + i + '" data-id="' + getId + '" data-stt="' + i + '" title="Delete" onclick="deleteModel(this)"><i class="fa fa-trash"></i></a>'
                + '</td>'
                + '</tr>';
        }
        $('#tbodyRole').html(tbodyRoles);
    }

    function deleteModel(context) {
        var valueId = context.dataset.id;
        var valueStt = context.dataset.stt;
        var del = window.confirm("Do you want to DELETE?");
        if (del == true) {
            var token = $('#remove-user-form').find('input[name="_csrf"]').val();
            var arr = {
                id: valueId,
                role: $("#txtEditRole" + valueStt).val()
            }
            $.ajax({
                type: "POST",
                url: "/oauth-service/mng/user/" + arr.id + "/remove-role",
                data: jQuery.param(arr),
                beforeSend: function (xhr) {
                    busy = true;
                    xhr.setRequestHeader('X-CSRF-TOKEN', token);
                },
                success: function (data) {
                    alert("Delete Success!!");
                    loadDataUser();
                    $('#modal-user-edit').modal("toggle");
                },
                failure: function (errMsg) {
                    console.log(errMsg);
                }
            });
        }
    }
    function getRoles() {
        $.ajax({
            type: "GET",
            url: "/oauth-service/mng/role",
            data: {},
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                var html = '';
                var html = '';
                var getData = result.data;
                for (i in getData) {
                    html += '<option data-role = "' + getData[i].role + '" value="' + getData[i].id + '">' + getData[i].role + '</option>';
                }
                $('#idRoleAdd').html(html);
                // $('select').selectpicker();
                //
            }
        });
    }
    function addUser() {
        $('input[name="userName"]').val('');
        $('input[name="name"]').val('');
        $('input[name="chineseName"]').val('');
        $('input[name="email"]').val('');
        getRoles();
    }
    function postUserAdd() {
        var token = $('#add-form input[name="_csrf"]').val();
        var arr = {
            id: Number($('#idRoleAdd option:selected').val()), ///??
            username: $('input[name="userName"]').val(),
            name: $('input[name="name"]').val(),
            chineseName: $('input[name="chineseName"]').val(),
            email: $('input[name="email"]').val(),
            roles: [
                {
                    id: Number($('#idRoleAdd option:selected').val())
                }
            ]
        }
        $.ajax({
            type: "POST",
            url: "/oauth-service/mng/user",
            data: JSON.stringify(arr),
            contentType: "application/json; charset=utf-8",
            beforeSend: function (xhr) {
                busy = true;
                xhr.setRequestHeader('X-CSRF-TOKEN', token);
            },
            success: function (responsive) {
                if (responsive.result) {
                    alert("Add user Success!!");
                    loadDataUser();
                }
            },
            failure: function (errMsg) {
                console.log(errMsg);
            }
        });
    }
    function refreshUser(context) {
        $('input[name="idPass"]').val(context.dataset.id);
    }
    function applyRefreshPassword() {
        // var check = confirm("Now, You have want refresh password?");
        // if(check){
            var token = $('#refresh-form').find('input[name="_csrf"]').val();
            // console.log("tokedelete",token);
            var arr = {
                id: Number($('input[name="idPass"]').val())
            };
            $.ajax({
                type: "POST",
                url: "/oauth-service/mng/user/" + arr.id + "/reset-password",
                data: JSON.stringify(arr),
                contentType: "application/json; charset=utf-8",
                beforeSend: function (xhr) {
                    busy = true;
                    xhr.setRequestHeader('X-CSRF-TOKEN', token);
                },
                success: function (data) {
                    if (data) {
                        alert("Refresh password is success!!");
                        loadDataUser();
                    }
                },
                failure: function (errMsg) {
                    console.log(errMsg);
                }
            });
        // }
    }
    function listRoles() {
        $.ajax({
            type: "GET",
            url: "/oauth-service/mng/role",
            data: {},
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                var html = '';
                var html = '';
                var getData = result.data;
                for (i in getData) {
                    html += '<option value="' + getData[i].role + '">' + getData[i].role + '</option>';
                }
                $('#txtAddRole').html(html);
                // $('select').selectpicker();
            }
        });
    }
    function addNewRole(){
        $('#id-add-usered').attr('disabled', 'disabled');
        listRoles();
        var qtyTable = $('#tbl-role-edit');
        var lastTable;
        for(var i=0; i<qtyTable.length; i++){
            lastTable = qtyTable[i].id;
        }
        var html = '<tr id="newRow">'
                    + '<td></td>'
                    + '<td><select id="txtAddRole" class="form-control" type="text"></select></td>'
                    + '<td>'
                        + '<a class="btn add sm" id="confirmRow' + i + '" title="Confirm" onclick=" confirmAddNew('+getId+')">'
                        + '<i class="fa fa-check"></i>'
                        + '</a>'
                        + '<a class="btn cancel" id="cancelRow' + i + '" title="cancel" onclick="confirmCancel()">'
                        + '<i class="fa fa-times"></i>'
                        + '</a>'
                    + '</td>'
                    + '</tr>';
        $("#"+lastTable+" tbody").append(html);
        $("#txtAddModel").focus();
    }

    function confirmAddNew(getId){
        var token = $('#edit-form input[name="_csrf"]').val();
        var arr = {
            id: getId,
            role:  $("#txtAddRole option:selected").val()
        }
        $.ajax({
            type: "POST",
            url: "/oauth-service/mng/user/" + arr.id + "/add-role",
            data: jQuery.param(arr),
            beforeSend: function (xhr) {
                busy = true;
                xhr.setRequestHeader('X-CSRF-TOKEN', token);
            },
            success: function (data) {
                if (data) {
                    alert("Edit Success!!");
                    // getId = arr.id;
                    // valueRole = $("#txtAddRole").val();
                    // loadModal('');
                    loadDataUser();
                    confirmCancel();
                    $('#modal-user-edit').modal("toggle");
                } else {
                    alert("Edit faile!!");
                }
            },
            failure: function (errMsg) {
                console.log(errMsg);
            }
        });
    }
    function confirmCancel(){
        $("#newRow").remove();
        $('#id-add-usered').removeAttr('disabled');
    }

    var Pagination = {
        code: '',
        Extend: function(data) {
            data = data || {};
            Pagination.size = data.size || 300;
            Pagination.page = data.page || 1;
            Pagination.step = data.step || 3;
        },

        // add pages by number (from [s] to [f])
        Add: function(s, f) {
            for (var i = s; i < f; i++) {
                Pagination.code += '<a class="p-item page-' + i + '">' + i + '</a>';
            }
        },

        // add last page with separator
        Last: function() {
            Pagination.code += '<a><i>...</i></a><a class="p-item page-' + Pagination.size + '">' + Pagination.size + '</a>';
        },

        // add first page with separator
        First: function() {
            Pagination.code += '<a class="p-item">1</a><a><i>...</i></a>';
        },

        // change page
        Click: function() {
            Pagination.page = +this.innerHTML;
            dataset.page = Pagination.page - 1;
            loadData();
            Pagination.Start();
        },

        // previous page
        Prev: function() {
            Pagination.page--;
            if (Pagination.page < 1) {
                Pagination.page = 1;
            }
            dataset.page = Pagination.page - 1;
            loadData();
            Pagination.Start();
        },

        // next page
        Next: function() {
            Pagination.page++;
            if (Pagination.page > Pagination.size) {
                Pagination.page = Pagination.size;
            }
            dataset.page = Pagination.page - 1;
            loadData();
            Pagination.Start();
        },

        // binding pages
        Bind: function() {
            var a = Pagination.e.getElementsByClassName('p-item');
            if(a.length > 1) {
                for (var i = 0; i < a.length; i++) {
                    if (+a[i].innerHTML === Pagination.page) a[i].className = 'p-item current';
                    // if(+a[i].innerHTML == Pagination.size) i--;
                    a[i].addEventListener('click', Pagination.Click, false);
                }
            }
        },

        // write pagination
        Finish: function() {
            Pagination.e.innerHTML = Pagination.code;
            Pagination.code = '';
            Pagination.Bind();
        },

        // find pagination type
        Start: function() {
            if (Pagination.size < Pagination.step * 2 + 6) {
                Pagination.Add(1, Pagination.size + 1);
            }
            else if (Pagination.page < Pagination.step * 2 + 1) {
                Pagination.Add(1, Pagination.step * 2 + 4);
                Pagination.Last();
            }
            else if (Pagination.page > Pagination.size - Pagination.step * 2) {
                Pagination.First();
                Pagination.Add(Pagination.size - Pagination.step * 2 - 2, Pagination.size + 1);
            }
            else {
                Pagination.First();
                Pagination.Add(Pagination.page - Pagination.step, Pagination.page + Pagination.step + 1);
                Pagination.Last();
            }
            Pagination.Finish();
        },

        // binding buttons
        Buttons: function(e) {
            var nav = e.getElementsByTagName('a');
            nav[0].addEventListener('click', Pagination.Prev, false);
            nav[1].addEventListener('click', Pagination.Next, false);
        },

        // create skeleton
        Create: function(e) {

            var html = [
                '<a>&laquo;</a>', // previous button
                '<span></span>',  // pagination container
                '<a>&raquo;</a>'  // next button
            ];

            e.innerHTML = html.join('');
            Pagination.e = e.getElementsByTagName('span')[0];
            Pagination.Buttons(e);
        },

        // init
        Init: function(e, data) {
            Pagination.Extend(data);
            Pagination.Create(e);
            Pagination.Start();
        }
    };

    function pagination(size, page) {
        Pagination.Init(document.getElementById('pagination'), {
            size: size, // pages size
            page: page + 1,  // selected page
            step: 2,   // pages before and after current
        });
    };
</script>
</body>
</html>